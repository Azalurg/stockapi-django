<!doctype html>
<html lang="en">
<head>
    <title>Homepage | {{user.first_name}}</title>
</head>
<body>
    <h1>Hello {{user.first_name}}!</h1>
    <table>
        <thead>
        <tr>
            <td>Symbol</td>
            <td>Name</td>
            <td>Price</td>
            <td>Currency</td>
        </tr>
        </thead>
        <tbody>
        {% for stock in  stocks %}
        <tr>
            <td>{{stock.symbol}}</td>
            <td>{{stock.name}}</td>
            <td id="{{stock.symbol}}">{{stock.close|floatformat:2}}</td>
            <td>{{stock.currency}}</td>
        </tr>
    {% endfor %}
        </tbody>
    </table>

    <script type="text/javascript">
        let url = `ws://${window.location.host}/ws/stock-prices/`

        const chatSocket = new WebSocket(url)

        chatSocket.onmessage = function(e){
            let data = JSON.parse(e.data)
            stockPrice = document.getElementById(data["symbol"]);
            console.log(data)
            if (stockPrice) {
                stockPrice.textContent = `${parseFloat(data["price"]).toFixed(2)}`
            }
        }
    </script>
</body>
</html>